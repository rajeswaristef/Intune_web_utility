<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Intune Functionality</title>
  <style>
    
    body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbar due to default body margin */
        }
        .input-details {
            height: 30vh; /* 50% of the viewport height */
            width: 100%;
            display: flex;
            color: black; /* Text color on the color sections */
            padding-top: 20px;
            font-style:serif ;
            font-weight: bold;

        }
        .heading-details {
            height: 5vh; /* 5% of the viewport height */
            width: 100%;
            display: flex;
            justify-content: center; /* Center the content horizontally */
            align-items: center; /* Center the content vertically */
            text-align: center;
            color: black; /* Text color on the color sections */
        }

        label {
        display: block;
        margin-bottom: 5px;
        color: #4d4d4d; /* Text color */
        font-size: 16px; /* Font size */
    }
    .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 40%;
            text-align: center;
        }
        .modal h2 {
            margin-bottom: 20px;
        }
        .radio-group {
            display: flex;
            margin-top: 10px;
            margin-left: 150px;
            margin-bottom:10px
        }
        .radio-group label{
            
            margin-right: 100px;
        }



.container {
    height: 70vh; /* 50% of the viewport height */
    width: 100%;
    display: flex;
    color: black; /* Text color on the color sections */
}

#color1 {
    background-color: #3498db; /* Change this to the first color */
}

#color2 {
    background-color: white; /* Change this to the second color */
}


    h1 {
      margin: 20px 0;
      color: blue; /* Set the color for the h1 element */
      margin-bottom: 20px;

    }


    .action-div {
      width: 200px;
      height: 160px;
      margin: 20px;
      padding: 10px;
      border: 2px solid #333;
      border-radius: 8px;
      background-color: #add8e6; /* Light Blue */
      display: inline-block;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .action-div:hover {
      background-color: #87ceeb; /* Slightly darker blue on hover */
    }

    .action-div h2 {
      margin: 5px 0;
    }

    .action-div p {
      font-size: 14px;
      color: #333;
      margin: 0;
    }

    .action-div img {
      max-width: 50px; /* Adjust the maximum width of the image */
      max-height: 50px; /* Adjust the maximum height of the image */
      margin-bottom: 10px;
      display: flex;
        justify-content: center; /* Center the content horizontally */
        align-items: center; /* Center the content vertically */
        text-align: center;
    }

    input[type="text"],
    input[type="email"],
    select {
        margin-top: 5px;
        width: 100%; /* Full width */
        padding: 10px; /* Increased padding */
        margin-bottom: 10px;
        border: 1px solid #ccc; /* Light border */
        border-radius: 3px;
        font-size: 14px; /* Font size */
        outline: none;
    }
    .styled-button {
    font-size: 15px;
    width: 10%; /* Full width */
    padding: 14px 2px;
    height: 10px;
    margin-top: 150px;
    margin-right: 15px;
    text-align: center;
    display: flex; /* Use flexbox */
    align-items: center; /* Center vertically */
    justify-content: center; /* Center horizontally */}

    button:disabled {
        opacity: 0.5; /* Optional: Add a visual indication that the button is disabled */
        pointer-events: none; /* Disable pointer events to prevent user interaction */
    }

    .input-container {
        margin-top: 15px; /* Adjust margin as needed */
        padding: 40px;
    }

    label {
        display: block;
        margin-bottom: 5px; /* Adjust margin as needed */
    }

    input,
    select,
    button {
        width: 200px; /* Adjust width as needed */
        height: 30px; /* Adjust height as needed */
    }
    #machine {
        height: 50px; /* Adjust height as needed */
    }    
    .input-container button {
        margin-top: 25px; /* Adjust the margin-top as needed */
        width: 180px;
        height: 50px;
    }

    #reset {
        width: 100px; /* Adjust the width as needed */
        color: #000000;    }

    #cancel {
        width: 100px; /* Adjust the width as needed */
        color: #000000;    }

    /* Style the select element */
    #selectGroup {
        width: 100%; /* Make the select element full width */
        margin-bottom: 15px; /* Add some space below the select element */
        height: 50px;
    }

    /* Style the buttons */
    #confirmGroupButton,
    #closeGroupModal {
        width: 50%; /* Make the buttons full width */
        color: black; /* Text color */
        margin-bottom: 10px; /* Add some space between buttons */
    }

    .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

/* Content section styles */
.content-section {
    margin-bottom: 20px;
}

.group-section,
.user-section {
    margin-left: 20px;
}

.app-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Adjust the column width as needed */
    gap: 20px;
    padding: 10px;
}

.app-item {
    border: 1px solid #ccc;
    padding: 10px;
    cursor: pointer;
}

.app-item:hover {
    background-color: #f0f0f0;
}

.dialog {
            display: none;
            position: fixed;
            z-index: 1;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 400px; /* Set the width as needed */
            max-width: 80%; /* Max width of the modal */
            max-height: 80vh; /* Set maximum height relative to the viewport height */
            padding: 20px; /* Adjust padding as needed */
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto; /* Enable vertical scrolling if needed */
        }

        .dialog h3 {
            margin-top: 0;
        }

        .dialog button {
            display: block;
            margin-bottom: 10px;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: #f9f9f9;
            cursor: pointer;
        }

        .dialog button:hover {
            background-color: #e9e9e9;
        }


.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

 ul {
        list-style: none;
        padding: 0;
        }

        ul li {
        cursor: pointer;
        margin-bottom: 5px;
        }

        ul li:hover {
        background-color: #f0f0f0;
        }
        /* Modal styles */

  </style>
</head>
<body>

<div class="heading-details" id="color1">
    <img src="khclogo.png" alt="Image Description" height="40px" width="300px">
</div>

  <!-- <input type="text" placeholder="Ticket No:" id="ticketNo"><br>
  <input type="text" placeholder="User Email:" id="userEmail"><br>
  <input type="text" placeholder="Machine Name:" id="machineName"><br> -->
  
  
<div class="input-details" id="color1">

    <div class="input-container">
        <label for="ticketNo">Ticket No:</label>
        <input type="text" id="ticketNo" placeholder="Enter Ticket No" maxlength="10">
    </div>
    
    <div class="input-container">
        <label for="userEmail">User Email:</label>
        <input type="email" id="userEmail" placeholder="Enter User Email">
    </div>
    
    <div class="input-container">
        <label for="machineName">Machine Name:</label>
        <select id="machine" name="machine" required disabled>
            <option value="" selected disabled>Select a Machine</option>
        </select>
    </div>
    
    <div class="input-container">
        <button type="button" id="getUserDevices" placeholder="Get User Devices" disabled>Get User Devices</button>
    </div>

    <button class="styled-button"  id="reset">Reset Form</button>
    <button class="styled-button"  id="cancel">Cancel</button>



</div>


<div class="container" id="color2">

    <button id="syncAction" class="action-div" disabled>
        <p> Sync</p>
        <span>Synchronize data between devices.</span>
      </button>  

      <button id="rebootAction" class="action-div" disabled>
        <p>Reboot</p>
        <span>Restart the device to apply changes.</span>
      </button>
      
      <button id="recoveryAction" class="action-div" disabled>
        <p>Recovery</p>
        <span>Enter recovery mode for troubleshooting.</span>
      </button>
      
      <button id="pushAppAction" class="action-div" disabled>
        <p>Push App</p>
        <span>Install and deploy a new application.</span>
      </button>
      
      <button id="removeAppAction" class="action-div" disabled>
        <p>Remove App</p>
        <span>Uninstall an existing application.</span>
      </button>
      
      <button id="wipeAction" class="action-div" disabled>
        <p>Wipe</p>
        <span>Erase all data on the device.</span>
      </button>
      
      <button id="remoteLockAction" class="action-div" disabled>
        <p>Remote Lock</p>
        <span>Lock the device remotely for security.</span>
      </button>
      
          <!-- Add a modal for wipe options (initially hidden) -->
    <div id="wipeModal" class="modal">
        <div class="modal-content">
            <h2>Choose Wipe Type</h2>
            <button id="partialWipe">Partial Wipe</button>
            <button id="fullWipe">Full Wipe</button>
            <button id="closeWipeModal">Close</button>
        </div>
    </div>
    
    <!-- Add a modal for group selection (initially hidden) -->
    <div id="groupSelectionModal" class="modal">
        <div class="modal-content">
            <h2>Select a Group</h2> 
            <label for="selectGroup">Select a group:</label>
            <select id="selectGroup">
                <!-- Options will be added dynamically using JavaScript -->
            </select>
            <button id="confirmGroupButton">Confirm</button>
            <button id="closeGroupModal">Close</button>
        </div>
    </div>
   

    <div id="deviceSelectionModal" class="modal">
        <div class="modal-content">
            <h2>Select User or Device to add in to group</h2>
            <div class="radio-group">
                <input type="radio" id="userOption" name="memberOption" value="user">
                <label for="userOption">User</label>
                <input type="radio" id="deviceOption" name="memberOption" value="device">
                <label for="deviceOption">Device</label>
            </div>
            <div id="memberInfo" style="display: none;">
                <p><strong>Selected Member:</strong> <span id="selectedMemberInfo"></span></p>
            </div>
            <button id="confirmMemberButton">Confirm</button>
            <button id="closeDeviceSelectionModal">Close</button>
        </div>
    </div>

    <div id="deviceRemovalModal" class="modal">
        <div class="modal-content">
            <h2>Select User or Device to Remove from the group</h2>
            <div class="radio-group">
                <input type="radio" id="userOption1" name="memberOption" value="user">
                <label for="userOption1">User</label>
                <input type="radio" id="deviceOption1" name="memberOption" value="device">
                <label for="deviceOption1">Device</label>
            </div>
            <div id="memberInfo1" style="display: none;">
                <p><strong>Selected Member:</strong> <span id="selectedMemberInfo1"></span></p>
            </div>
            <button id="removeDeviceUserButton">Confirm</button>
            <button id="closeDeviceRemovalModal">Close</button>
        </div>
    </div>

 
</div>

<div class="app-modal-container">
    <!-- Modal for displaying app list -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Select an application </h2>
            <div id="appList" class="app-list"></div>
        </div>
    </div>
</div>

<!-- The modal -->
<div id="assignmentModal" class="modal">
    <div id="modalContent" class="modal-content">
        <span class="close">&times;</span>
        <h2>Assignments:</h2>
        <div id="requiredSection" class="content-section">
            <h3>Required:</h3>
            <div id="requiredGroups" class="group-section"></div>
            <div id="requiredUsers" class="user-section"></div>
        </div>
        <div id="availableSection" class="content-section">
            <h3>Available for enrolled Devices:</h3>
            <div id="availableGroups" class="group-section"></div>
            <div id="availableUsers" class="user-section"></div>
        </div>
        <div id="uninstallSection" class="content-section">
            <h3>Uninstall:</h3>
            <div id="uninstallGroups" class="group-section"></div>
            <div id="uninstallUsers" class="user-section"></div>
        </div>
    </div>
</div>


<div id="dataTypeDialog" class="dialog">
    <span class="close">&times;</span>
    <h3>Select a Data Type:</h3>
    <div id="dataTypeList" class="scrollable-dialog"></div>
    
  </div>
  
<div id="appsForDataTypeDialog" class="dialog">
    <span class="close">&times;</span>
    <h3>Select an App:</h3>
    <div id="appListForDataType" class="scrollable-dialog"></div>
</div>

<div id="pushSelectionDialog" class="dialog">
    <span id="closeDialogButton" class="close">&times;</span>
    <p>Where do you want to push the application?</p>
    <button id="pushToDeviceButton">Push to Device</button>
    <button id="pushToUserButton">Push to User</button>
    
</div>


<div id="removeSelectionDialog" class="dialog">
    <span id="closeDialogButton" class="close">&times;</span>
    <p>Where do you want to remove the application?</p>
    <button id="removeToDeviceButton"> Remove from Device</button>
    <button id="removeToUserButton">Remove to User</button>
    
</div>



<div id="deviceGroupsDialog" class="dialog">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Device Groups:</h2>
        <div id="deviceGroupsContent" class="content-section"></div>
    </div>
</div>

<div id="userGroupsDialog" class="dialog">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Users Groups:</h2>
        <div id="userGroupsContent" class="content-section"></div>
    </div>

</div>


  <script>

    const accessToken = localStorage.getItem('accessToken');
    const authforApp=localStorage.getItem('authforApp')
    const recovery_key_auth=localStorage.getItem('recovery_key_auth')
    const machineSelect = document.getElementById('machine');
    const devicesData = []; // Store devices data (including IDs and names)
    
    const ticketNoInput = document.getElementById('ticketNo');
    const userEmailInput = document.getElementById('userEmail');
    const getUserDevicesButton = document.getElementById('getUserDevices');
    const syncButton = document.getElementById('syncAction');
    const rebootButton = document.getElementById('rebootAction');
    const recoveryKeyButton = document.getElementById('recoveryAction');
    const pushAppButton = document.getElementById('pushAppAction');
    const removeAppButton = document.getElementById('removeAppAction');
    const remoteWipeButton = document.getElementById('wipeAction');
    const remoteLockButton = document.getElementById('remoteLockAction');
    const resetButton = document.getElementById('reset');
    const cancelButton = document.getElementById('cancel');



    function isEmailValid(email) {
        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        return emailRegex.test(email);
    }

    // Function to check if all required inputs are filled
    function areInputsFilled() {
        return ticketNoInput.value.trim() !== '' && isEmailValid(userEmailInput.value.trim());
    }

    // Function to enable/disable buttons based on input status
    function updateButtonStatus() {
        getUserDevicesButton.disabled = !areInputsFilled();
    }

    // Add event listeners to input fields to update button status
    ticketNoInput.addEventListener('input', updateButtonStatus);
    userEmailInput.addEventListener('input', updateButtonStatus);


    // Event listener for the reset button
    resetButton.addEventListener('click', () => {
        // Clear input fields and disable buttons
        ticketNoInput.value = '';
        userEmailInput.value = '';
        getUserDevicesButton.disabled = true;
        machineSelect.innerHTML = '<option value="" selected disabled>Select a Machine</option>';
        syncButton.disabled = true;
        rebootButton.disabled = true;
        recoveryKeyButton.disabled = true;
        pushAppButton.disabled = true;
        removeAppButton.disabled = true;
        remoteLockButton.disabled = true;
        remoteWipeButton.disabled = true;
        
    });

    // Event listener for the cancel button
    cancelButton.addEventListener('click', () => {
        // Implement the cancel action here (e.g., close the form)
        alert('Cancel button clicked. Implement cancel action here.');
        window.location.href = 'index.html';
    });


    // Event listener for the "Get User Devices" button
    getUserDevicesButton.addEventListener('click', () => {
        const username = userEmailInput.value.trim();
        // Make an API request to get user devices
        fetch(`https://graph.microsoft.com/v1.0/users/${username}/managedDevices`, {
            headers: {
                'Authorization': `Bearer ${authforApp}`
            }
        })
        .then(response => response.json())
        .then(data => {
            // Check if the API request was successful and data contains the list of devices
            if (data && data.value && data.value.length > 0) {
                // Store the devices data (including names and IDs)
                devicesData.length = 0; // Clear existing data
                devicesData.push(...data.value.map(device => ({
                    id: device.id, // Capture the device ID
                    deviceName: device.deviceName,
                    operatingSystem:device.operatingSystem,
                    azureADDeviceId:device.azureADDeviceId // Capture the device name
                })));

                // Populate the select element with device names
                machineSelect.innerHTML = ''; // Clear existing options
                // Create and append options for each device name
                devicesData.forEach(deviceData => {
                    const option = document.createElement('option');
                    option.value = deviceData.id; // Set the value as the device ID
                    option.text = deviceData.deviceName;
                    option.operatingSystem=deviceData.operatingSystem;
                    option.azureADDeviceId=deviceData.azureADDeviceId // Display the device name
                    machineSelect.appendChild(option);
                });

                // Enable the select element
                machineSelect.disabled = false;
            } else {
                // Handle the case where no devices are found
                alert('No devices found for the user.');
            }
        })
        .catch(error => {
            // Handle any errors that occurred during the API request
            console.error('Error fetching user devices:', error);
            alert('Error fetching user devices. Please try again later.');
        });
    });

    
    machineSelect.addEventListener('change', () => {
        // Enable the remaining buttons when a machine is selected
        syncButton.disabled = false;
        rebootButton.disabled = false;
        remoteLockButton.disabled = false;
        recoveryKeyButton.disabled=false;
        removeAppButton.disabled = false;
        remoteWipeButton.disabled = false;
        pushAppButton.disabled = false;
    });


     // Event listener for the "Sync" button

syncButton.addEventListener('click', () => {
        // Get the selected device ID
        const selectedDeviceId = machineSelect.options[machineSelect.selectedIndex].value;
        const selectedDeviceName=machineSelect.options[machineSelect.selectedIndex].text;
        const syncEndpoint = `https://graph.microsoft.com/v1.0/deviceManagement/managedDevices/${selectedDeviceId}/microsoft.graph.syncDevice`;

        // Create headers with the access token
        const headers = new Headers({
            'Authorization': `Bearer ${authforApp}`
        });

        // Create the fetch request options
        const requestOptions = {
            method: 'POST',
            headers: headers,
            redirect: 'follow'
        };

        // Perform the sync operation
        fetch(syncEndpoint, requestOptions)
            .then(response => {
                if (response.ok) {
                    // Sync was successful, you can add your success handling code here
                    alert(`Machine ${selectedDeviceName} will be synced shortly.`);
                } else {
                    // Handle errors here
                    alert(`Failed to sync Machine ${selectedDeviceName}. Please try again after some time.`);
                }
            })
            .catch(error => {
                // Handle network errors or other exceptions here
                console.error('Something went wrong during sync action`, please try again after sometime..', error);
            });
    });

// Event listener for the "Reboot" button   
rebootButton.addEventListener('click', () => {
        // Get the selected device ID
        const selectedDeviceId = machineSelect.options[machineSelect.selectedIndex].value;
        const selectedDeviceName=machineSelect.options[machineSelect.selectedIndex].text;
        const rebootEndpoint = `https://graph.microsoft.com/v1.0/deviceManagement/managedDevices/${selectedDeviceId}/microsoft.graph.rebootNow`;

        // Create headers with the access token
        const headers = new Headers({
            'Authorization': `Bearer ${authforApp}`
        });

        // Create the fetch request options
        const requestOptions = {
            method: 'POST',
            headers: headers,
            redirect: 'follow'
        };

        // Perform the reboot operation
        fetch(rebootEndpoint, requestOptions)
            .then(response => {
                if (response.ok) {
                    // Reboot was successful, you can add your success handling code here
                    alert(`Machine ${selectedDeviceName} will be rebooted shortly during the next sync cycle...`);
                } else {
                    // Handle errors here
                    alert(`Failed to Reboot Machine ${selectedDeviceName}. Please try again after some time.`);
                }
            })
            .catch(error => {
                // Handle network errors or other exceptions here
                console.error('Something went wrong during reboot action`, please try again after sometime..', error);
            });
    });
// Event listener for the "Remote Lock" button
    remoteLockButton.addEventListener('click', () => {
        // Get the selected device ID
        const selectedDeviceId = machineSelect.options[machineSelect.selectedIndex].value;
        const selectedDeviceName = machineSelect.options[machineSelect.selectedIndex].text;
        const operatingSystem = machineSelect.options[machineSelect.selectedIndex].operatingSystem

        // Check if the operating system is not Windows or macOS
        if (operatingSystem && !['Windows', 'MacOS'].includes(operatingSystem)) {
            // The operating system is not Windows or macOS, proceed with remote lock

            const remoteLockEndpoint = `https://graph.microsoft.com/v1.0/deviceManagement/managedDevices/${selectedDeviceId}/microsoft.graph.remoteLock`;

            // Create headers with the access token
            const headers = new Headers({
                'Authorization': `Bearer ${authforApp}`
            });

            // Create the fetch request options
            const requestOptions = {
                method: 'POST',
                headers: headers,
                redirect: 'follow'
            };

            // Perform the remote lock operation
            fetch(remoteLockEndpoint, requestOptions)
                .then(response => {
                    if (response.ok) {
                        // Remote lock was successful, you can add your success handling code here
                        alert(`Machine ${selectedDeviceName} is locked.`);
                    } else {
                        // Handle errors here
                        alert(`Failed to lock Machine ${selectedDeviceName}. Please try again after some time.`);
                    }
                })
                .catch(error => {
                    // Handle network errors or other exceptions here
                    console.error('Something went wrong during remote lock action`, please try again after sometime..', error);
                });
        } else {
            // The operating system is Windows or macOS, do not perform remote lock
            alert(`Remote Lock is not supported for Windows or macOS.`);
        }
    });
    


    
    // Event listener for the "Wipe" button
    remoteWipeButton.addEventListener('click', () => {
        // Display the wipe modal when the button is clicked
        document.getElementById('wipeModal').style.display = 'block';
    });

    // Event listener for the "Partial Wipe" button in the wipe modal
      document.getElementById('partialWipe').addEventListener('click', () => {
        // Implement the partial wipe functionality here
        const wipeBody = {
            wipe: {
                keepEnrollmentData: 'true',
                keepUserData: 'true'
            }
        };

        // Get the selected device ID
        const selectedDevice = machineSelect.options[machineSelect.selectedIndex].value;

        if (selectedDevice) {
            const partialWipeEndpoint = `https://graph.microsoft.com/v1.0/deviceManagement/managedDevices/${selectedDevice.id}/microsoft.graph.wipe`;

            // Create headers with the access token
            const headers = new Headers({
                'Authorization': `Bearer ${authforApp}`,
                'Content-Type': 'application/json'
            });

            // Create the fetch request options
            const requestOptions = {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(wipeBody),
                redirect: 'follow'
            };

            // Perform the partial wipe operation
            fetch(partialWipeEndpoint, requestOptions)
                .then(response => {
                    if (response.ok) {
                        alert('Partial wipe operation initiated successfully.');
                    } else {
                        alert('Failed to initiate partial wipe operation.');
                    }
                })
                .catch(error => {
                    console.error('Error initiating partial wipe operation:', error);
                    alert('Error initiating partial wipe operation. Please try again later.');
                });
        }
        // Close the wipe modal
        document.getElementById('wipeModal').style.display = 'none';
    });

    // Event listener for the "Full Wipe" button in the wipe modal
    document.getElementById('fullWipe').addEventListener('click', () => {
        // Implement the full wipe functionality here
        const wipeBody = {
            wipe: {
                keepEnrollmentData: 'false',
                keepUserData: 'false'
            }
        };

        // Get the selected device ID
        const selectedDevice = machineSelect.options[machineSelect.selectedIndex].value;

        if (selectedDevice) {
            const fullWipeEndpoint = `https://graph.microsoft.com/v1.0/deviceManagement/managedDevices/${selectedDevice.id}/microsoft.graph.wipe`;

            // Create headers with the access token
            const headers = new Headers({
                'Authorization': `Bearer ${authforApp}`,
                'Content-Type': 'application/json'
            });

            // Create the fetch request options
            const requestOptions = {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(wipeBody),
                redirect: 'follow'
            };

            // Perform the full wipe operation
            fetch(fullWipeEndpoint, requestOptions)
                .then(response => {
                    if (response.ok) {
                        alert('Full wipe operation initiated successfully.');
                    } else {
                        alert('Failed to initiate full wipe operation.');
                    }
                })
                .catch(error => {
                    console.error('Error initiating full wipe operation:', error);
                    alert('Error initiating full wipe operation. Please try again later.');
                });
        }


        // Close the wipe modal
        document.getElementById('wipeModal').style.display = 'none';
    });
    
    recoveryKeyButton.addEventListener('click', async () => {
    // Get the selected device ID
    const selectedDeviceId = machineSelect.options[machineSelect.selectedIndex].azureADDeviceId;
    const selectedDeviceName = machineSelect.options[machineSelect.selectedIndex].text;

    try {
        // Obtain the BitLocker recovery key auth token
        

       
            // Extract the access token from the auth token response
            

            // Define the Microsoft Graph API URL for BitLocker recovery keys
            const recoveryKeyEndpoint = `https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys?$filter=deviceId eq '${selectedDeviceId}'&$orderby=createdDateTime desc`;

            // Create headers with the access token
            const headers = new Headers({
                'Authorization': `Bearer ${recovery_key_auth}`
            });

            // Create the fetch request options
            const requestOptions = {
                method: 'GET',
                headers: headers,
                redirect: 'follow'
            };

            // Perform the BitLocker recovery key retrieval operation
            const response = await fetch(recoveryKeyEndpoint, requestOptions);
            const data = await response.json();

            if (data.value.length > 0) {
                const recoveryKeyId = data.value[0].id;
                const recoveryKeyDetailsEndpoint = `https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys/${recoveryKeyId}?$select=key`;

                // Fetch the BitLocker recovery key details
                const keyResponse = await fetch(recoveryKeyDetailsEndpoint, requestOptions);
                const recoveryKeyData = await keyResponse.json();

                const recoveryKey = recoveryKeyData.key;
                // Display the BitLocker recovery key
                alert(`Recovery Key for ${selectedDeviceName} is: ${recoveryKey}`);
            } else {
                alert(`Machine ${selectedDeviceName} does not have any Recovery key attached to it...`);
            }
        
        }
     catch (error) {
        console.error('Error obtaining BitLocker recovery key:', error);
        alert('Error obtaining BitLocker recovery key. Please try again later.');
    }
});

        // Function to create a custom dialog for selecting a group

// Function to create a custom dialog for selecting a group

// Store retrieved apps to prevent duplicates
// Initialize the retrievedApps array
let retrievedApps = [];


pushAppButton.addEventListener('click', () => {
    action_item = "push"

    const selectedDeviceId = machineSelect.options[machineSelect.selectedIndex].azureADDeviceId;
    const selectedDeviceName = machineSelect.options[machineSelect.selectedIndex].text;
    const userEmail = userEmailInput.value.trim();
    // Make an API request to get applications
    fetch('https://graph.microsoft.com/v1.0/deviceAppManagement/mobileApps', {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.value && data.value.length > 0) {
            retrievedApps = data.value;

            // Extract unique data types
            const dataTypes = [...new Set(data.value.map(app => app['@odata.type']))];
            showDataTypesDialog(dataTypes,selectedDeviceId,userEmail,action_item);
        } else {
            alert('No applications found in Intune.');
        }
    })
    .catch(error => {
        console.error('Error fetching applications:', error);
        alert('Error fetching applications. Please try again later.');
    });
});


removeAppButton.addEventListener('click', () => {
    action_item = "remove"
    console.log("inside remove app button")
    const selectedDeviceId = machineSelect.options[machineSelect.selectedIndex].azureADDeviceId;
    const selectedDeviceName = machineSelect.options[machineSelect.selectedIndex].text;
    const userEmail = userEmailInput.value.trim();
    // Make an API request to get applications
    fetch('https://graph.microsoft.com/v1.0/deviceAppManagement/mobileApps', {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.value && data.value.length > 0) {
            retrievedApps = data.value;

            // Extract unique data types
            const dataTypes = [...new Set(data.value.map(app => app['@odata.type']))];
            showDataTypesDialog(dataTypes,selectedDeviceId,userEmail,action_item);
        } else {
            alert('No applications found in Intune.');
        }
    })
    .catch(error => {
        console.error('Error fetching applications:', error);
        alert('Error fetching applications. Please try again later.');
    });
});



function showDataTypesDialog(dataTypes,selectedDeviceId,userEmail,action_item) {
    console.log("inside showDataTypesDialog function")

    // Assuming you have a dialog element with an ID 'dataTypeDialog'
    const dataTypeDialog = document.getElementById('dataTypeDialog');
    const dataTypeList = document.getElementById('dataTypeList'); // Element to display data types

    // Clear previous data types
    dataTypeList.innerHTML = '';

    // Create and append data type items to the list container
    dataTypes.forEach(dataType => {
        const dataTypeItem = document.createElement('div');
        dataTypeItem.classList.add('data-type-item');
        dataTypeItem.textContent = dataType;
        dataTypeList.appendChild(dataTypeItem);

        // Handle click on data type item
        dataTypeItem.addEventListener('click', () => {
            handleDataTypeSelection(dataType,selectedDeviceId,userEmail,action_item);
            // Close the data type dialog or perform other actions as needed
        });
    });
    const modal1 = document.getElementById('dataTypeDialog');
   modal1.style.display = 'block';

   const closeButton1 = modal1.querySelector('.close');
   closeButton1.onclick = function() {
    modal1.style.display = 'none';
};
  
    
}

// Function to handle data type selection
function handleDataTypeSelection(selectedDataType,selectedDeviceId,userEmail,action_item) {
console.log("inside handleDataTypeSelection function")

// Retrieve apps based on selected data type
const appsForSelectedType = retrievedApps.filter(app => app['@odata.type'] === selectedDataType);

if (appsForSelectedType.length > 0) {
    // Extract app names for display in a new dialog
    const appsList = appsForSelectedType.map(app => ({ id: app.id, displayName: app.displayName }));
    const appNamesForSelectedType = appsList.map(app => app.displayName);
    // Show a dialog with apps for the selected data type
    showAppsForDataTypeDialog(appNamesForSelectedType, appsForSelectedType,appsList,selectedDeviceId,userEmail,action_item);
} else {
    alert('No applications found for the selected data type.');
}
}

// Function to display apps for a selected data type in a new dialog
function showAppsForDataTypeDialog(appNames, appsData,appsList,selectedDeviceId,userEmail,action_item) {
    console.log("inside showAppsForDataTypeDialog function")

// Assuming you have a dialog element with an ID 'appsForDataTypeDialog'
const appsForDataTypeDialog = document.getElementById('appsForDataTypeDialog');
const appListForDataType = document.getElementById('appListForDataType'); // Element to display apps

// Clear previous apps
appListForDataType.innerHTML = '';

// Create and append app items to the list container
appNames.forEach((appName, index) => {
    const appItem = document.createElement('div');
    appItem.classList.add('app-item');
    appItem.textContent = appName;
    appListForDataType.appendChild(appItem);

    // Handle click on app item
    appItem.addEventListener('click', () => {
        handleAppSelection(index, appsList,selectedDeviceId,userEmail,action_item);
        // Close the apps for data type dialog or perform other actions as needed
    });
});

// Show the apps for data type dialog
const modal1 = document.getElementById('appsForDataTypeDialog');

modal1.style.display = 'block';
const closeButton1 = modal1.querySelector('.close');
 closeButton1.onclick = function() {
modal1.style.display = 'none';
};

}


// Function to handle selection of an application using the retrievedApps array
function handleAppSelection(index, appsList,selectedDeviceId,userEmail,action_item) {
    const selectedApp = appsList[index];
    console.log("inside handleAppSelection function")


    if (selectedApp) {
        if (action_item === 'push') 
        {
            // Show dialog to select where to push the application (to a device or a user)
            displayPushSelectionDialog(selectedApp,selectedDeviceId,userEmail,action_item);
        } 
        else if (action_item === 'remove') 
        {
            console.log("calling displayRemoveSelectionDialog function")
 
            // Show dialog to select where to push the application (to a device or a user)
                displayRemoveSelectionDialog(selectedApp,selectedDeviceId,userEmail,action_item);        }

    } else {
        alert('Error: Unable to retrieve details for the selected application.');
    }
}

let devicePushListener, userPushListener, closeDialogListener;
let deviceRemoveListener, userRemoveListener ;

// Function to display the push selection dialog
function displayPushSelectionDialog(selectedApp,selectedDeviceId,userEmail,action_item) {
    const pushDialog = document.getElementById('pushSelectionDialog');
    pushDialog.style.display = 'block';

    const pushToDeviceButton = document.getElementById('pushToDeviceButton');
    const pushToUserButton = document.getElementById('pushToUserButton');
    const closeDialogButton = document.getElementById('closeDialogButton');

    // Remove previous event listeners
    pushToDeviceButton.removeEventListener('click', devicePushListener);
    pushToUserButton.removeEventListener('click', userPushListener);
    closeDialogButton.removeEventListener('click', closeDialogListener);

    // Set up event listeners
    devicePushListener = () => {
        handleDeviceSelection(selectedApp,selectedDeviceId,userEmail,action_item);
        pushDialog.style.display = 'none';
    };
    userPushListener = () => {
        handleUserPush(selectedApp,selectedDeviceId,userEmail);
        pushDialog.style.display = 'none';
    };
    closeDialogListener = () => {
        pushDialog.style.display = 'none';
    };

    pushToDeviceButton.addEventListener('click', devicePushListener);
    pushToUserButton.addEventListener('click', userPushListener);
    closeDialogButton.addEventListener('click', closeDialogListener);
}


// Function to display the push selection dialog
function displayRemoveSelectionDialog(selectedApp,selectedDeviceId,userEmail,action_item) {
    console.log("inside displayRemoveSelectionDialog function")

    const removeDialog = document.getElementById('removeSelectionDialog');
    removeDialog.style.display = 'block';

    const removeToDeviceButton = document.getElementById('removeToDeviceButton');
    const removeToUserButton = document.getElementById('removeToUserButton');
    const closeDialogButton = document.getElementById('closeDialogButton');

    // Remove previous event listeners
    removeToDeviceButton.removeEventListener('click', deviceRemoveListener);
    removeToUserButton.removeEventListener('click', userRemoveListener);
    closeDialogButton.removeEventListener('click', closeDialogListener);

    // Set up event listeners
    deviceRemoveListener = () => {
        handleDeviceSelection(selectedApp,selectedDeviceId,userEmail,action_item);
        removeDialog.style.display = 'none';
    };
    userRemoveListener = () => {
        handleUserRemove(selectedApp,selectedDeviceId,userEmail,action_item);
        removeDialog.style.display = 'none';
    };
    closeDialogListener = () => {
        removeDialog.style.display = 'none';
    };

    removeToDeviceButton.addEventListener('click', deviceRemoveListener);
    removeToUserButton.addEventListener('click', userRemoveListener);
    closeDialogButton.addEventListener('click', closeDialogListener);
}






function handleDeviceSelection(selectedApp,selectedDeviceId,userEmail,action_item) {
    console.log("inside handleDeviceSelection function")

    const mobileAppId = selectedApp.id;

    fetch(`https://graph.microsoft.com/v1.0/deviceAppManagement/mobileApps/${mobileAppId}/assignments`, {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.value && data.value.length > 0) {
            const assignments = data.value;
            const deviceGroups = [];

            const promises = assignments.map(assignment => {
                const target = assignment.target;

                if (target['@odata.type'] === '#microsoft.graph.groupAssignmentTarget') {
                    const groupId = target.groupId;

                    const groupDetailsPromise = fetchGroupDetails(groupId);
                    const groupMembersPromise = fetchGroupMembers(groupId);

                    return Promise.all([groupDetailsPromise, groupMembersPromise])
                        .then(([groupDetails, members]) => {
                            const groupName = groupDetails.displayName.toLowerCase();

                            if (groupName.includes('device')) {
                                deviceGroups.push({
                                    groupName: groupDetails.displayName,
                                    intent: assignment.intent
                                });
                            } else {
                                const memberTypes = new Set(members.value.map(member => member['@odata.type']));
                                if (memberTypes.size === 1 && memberTypes.has('#microsoft.graph.device')) {
                                    deviceGroups.push({
                                        groupName: groupDetails.displayName,
                                        intent: assignment.intent
                                    });
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching group details or members:', error);
                        });
                }
            });

            Promise.all(promises)
                .then(() => {
                    if (deviceGroups.length > 0) {
                        console.log(" calling displayDeviceGroupsDialog.....")
                        displayDeviceGroupsDialog(deviceGroups,selectedDeviceId,userEmail,action_item);
                    } else {
                        
                        alert('No groups found to add device,please check in intune portal manually .');
                    }
                })
                .catch(error => {
                    console.error('Error in Promise.all:', error);
                });
        } else {
            alert('No app assignments found for the selected app,please check in intune portal manually .');
            // Handle scenario where no app assignments are found
        }
    })
    .catch(error => {
        console.error('Error fetching app assignments:', error);
        // Handle errors as needed
    });
}

// Function to fetch group details
function fetchGroupDetails(groupId) {
    return fetch(`https://graph.microsoft.com/v1.0/groups/${groupId}`, {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .catch(error => {
        console.error('Error fetching group details:', error);
    });
}

// Function to fetch group members
function fetchGroupMembers(groupId) {
    return fetch(`https://graph.microsoft.com/v1.0/groups/${groupId}/members`, {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .catch(error => {
        console.error('Error fetching group members:', error);
    });
}


function displayDeviceGroupsDialog(deviceGroups,selectedDeviceId,userEmail,action_item) {
    console.log(" inside displayDeviceGroupsDialog.....")

    const deviceGroupsDialog = document.getElementById('deviceGroupsDialog');
    const deviceGroupsContent = document.getElementById('deviceGroupsContent');

    // Clear previous content
    deviceGroupsContent.innerHTML = '';

    // Create and append group items to the dialog
    deviceGroups.forEach(group => {
        if(group.intent!=='uninstall'){
        const groupItem = document.createElement('div');
        groupItem.classList.add('group-item');
        groupItem.textContent = `Group Name: ${group.groupName}, Intent: ${group.intent}`;
        groupItem.addEventListener('click', () => {

            if (action_item === 'push') {
                 confirmation = confirm(`Do you want to add the app to group: ${group.groupName}?`);

            } else if (action_item === 'remove') {
                 confirmation = confirm(`Do you want to remove the app to group: ${group.groupName}?`);
            }

            if (confirmation) {
                fetchGroupID(group.groupName)
                        .then(groupID => {
                            if (groupID) 
                            {
                                if (action_item === 'push') {
                                    addDeviceToGroup(groupID,group.groupName,selectedDeviceId) 
                                }
                                else if (action_item === 'remove') 
                                {
                                    console.log(groupID)
                                    console.log(group.groupName)
                                    console.log(userEmail)
                                    console.log("calling removeDeviceToGroup function..")

                                    removeDeviceToGroup(groupID,group.groupName,userEmail)
                                }
                            } else {
                                alert('Group ID not found.');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching group ID:', error);
                        });
                
            }
        });
        deviceGroupsContent.appendChild(groupItem);
    }
    });

    // Show the device groups dialog
    const modal2 = document.getElementById('deviceGroupsDialog');
    modal2.style.display = 'block';
    const closeButton = modal2.querySelector('.close');
    closeButton.onclick = function() {
    modal2.style.display = 'none';
}
}

// Function to handle the selection of pushing the app to a user
function handleUserPush(selectedApp,selectedDeviceId,userEmail) {
    const mobileAppId = selectedApp.id;

    fetch(`https://graph.microsoft.com/v1.0/deviceAppManagement/mobileApps/${mobileAppId}/assignments`, {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.value && data.value.length > 0) {
            const assignments = data.value;
            const userGroups = [];

            const promises = assignments.map(assignment => {
                const target = assignment.target;

                if (target['@odata.type'] === '#microsoft.graph.groupAssignmentTarget') {
                    const groupId = target.groupId;

                    const groupDetailsPromise = fetchGroupDetails(groupId);
                    const groupMembersPromise = fetchGroupMembers(groupId);

                    return Promise.all([groupDetailsPromise, groupMembersPromise])
                        .then(([groupDetails, members]) => {
                            const groupName = groupDetails.displayName.toLowerCase();

                            if (groupName.includes('user')) {
                                userGroups.push({
                                    groupName: groupDetails.displayName,
                                    intent: assignment.intent
                                });
                            } else {
                                const memberTypes = new Set(members.value.map(member => member['@odata.type']));
                                if (memberTypes.size === 1 && memberTypes.has('#microsoft.graph.user')) {
                                    userGroups.push({
                                        groupName: groupDetails.displayName,
                                        intent: assignment.intent
                                    });
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching group details or members:', error);
                        });
                }
            });

            Promise.all(promises)
                .then(() => {
                    if (userGroups.length > 0) {
                        displayUserGroupsDialog(userGroups,selectedDeviceId,userEmail);
                    } else {
                        alert('No user groups found to add the app. Please check in Intune portal manually.');
                    }
                })
                .catch(error => {
                    console.error('Error in Promise.all:', error);
                });
        } else {
            alert('No app assignments found for the selected app. Please check in Intune portal manually.');
            // Handle scenario where no app assignments are found
        }
    })
    .catch(error => {
        console.error('Error fetching app assignments:', error);
        // Handle errors as needed
    });
}


// Function to handle the selection of removing the app to a user
function handleUserRemove(selectedApp,selectedDeviceId,userEmail,action_item) {
    const mobileAppId = selectedApp.id;

    fetch(`https://graph.microsoft.com/v1.0/deviceAppManagement/mobileApps/${mobileAppId}/assignments`, {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.value && data.value.length > 0) {
            const assignments = data.value;
            const userGroups = [];

            const promises = assignments.map(assignment => {
                const target = assignment.target;

                if (target['@odata.type'] === '#microsoft.graph.groupAssignmentTarget') {
                    const groupId = target.groupId;

                    const groupDetailsPromise = fetchGroupDetails(groupId);
                    const groupMembersPromise = fetchGroupMembers(groupId);

                    return Promise.all([groupDetailsPromise, groupMembersPromise])
                        .then(([groupDetails, members]) => {
                            const groupName = groupDetails.displayName.toLowerCase();

                            if (groupName.includes('user')) {
                                userGroups.push({
                                    groupName: groupDetails.displayName,
                                    intent: assignment.intent
                                });
                            } else {
                                const memberTypes = new Set(members.value.map(member => member['@odata.type']));
                                if (memberTypes.size === 1 && memberTypes.has('#microsoft.graph.user')) {
                                    userGroups.push({
                                        groupName: groupDetails.displayName,
                                        intent: assignment.intent
                                    });
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching group details or members:', error);
                        });
                }
            });

            Promise.all(promises)
                .then(() => {
                    if (userGroups.length > 0) {
                        displayUserGroupsDialog(userGroups,selectedDeviceId,userEmail,action_item);
                    } else {
                        alert('No user groups found to remove the app. Please check in Intune portal manually.');
                    }
                })
                .catch(error => {
                    console.error('Error in Promise.all:', error);
                });
        } else {
            alert('No app assignments found for the selected app. Please check in Intune portal manually.');
            // Handle scenario where no app assignments are found
        }
    })
    .catch(error => {
        console.error('Error fetching app assignments:', error);
        // Handle errors as needed
    });
}




// Function to display user groups dialog
function displayUserGroupsDialog(userGroups,selectedDeviceId,userEmail,action_item) {
    const userGroupsDialog = document.getElementById('userGroupsDialog');
    const userGroupsContent = document.getElementById('userGroupsContent');

    // Clear previous content
    userGroupsContent.innerHTML = '';

    // Create and append group items to the dialog
    userGroups.forEach(group => {
        if(group.intent!=='uninstall'){
        const groupItem = document.createElement('div');
        groupItem.classList.add('group-item');
        groupItem.textContent = `Group Name: ${group.groupName}, Intent: ${group.intent}`;
        groupItem.addEventListener('click', () => {
            if (action_item === 'push') {
                 confirmation = confirm(`Do you want to add the app to group: ${group.groupName}?`);

            } else if (action_item === 'remove') {
                 confirmation = confirm(`Do you want to remove the app to group: ${group.groupName}?`);
            }
            if (confirmation) {
                
                fetchGroupID(group.groupName)
                        .then(groupID => {
                            if (groupID) {
                                if (action_item === 'push') {
                                    addUserToGroup(groupID,group.groupName,userEmail) }
                                    else if (action_item === 'remove') {
                                
                                    removeUserToGroup(groupID,group.groupName,userEmail)
                                }

                            } else {
                                alert('Group ID not found.');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching group ID:', error);
                        });
            }
        });
        userGroupsContent.appendChild(groupItem);
    }
    });

    // Show the user groups dialog
    userGroupsDialog.style.display = 'block';
    const closeButton = userGroupsDialog.querySelector('.close');
    closeButton.onclick = function() {
        userGroupsDialog.style.display = 'none';
    };

}



function addDeviceToGroup(groupId,groupName,deviceId) 
{    
    fetch(`https://graph.microsoft.com/v1.0/devices`, {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Failed to fetch devices. Status: ${response.status}`);
        }
        return response.json();
    })
    .then(devicesData => {
        const matchingDevice = devicesData.value.find(device => device.deviceId === deviceId);
        if (matchingDevice) {
            const body = {
                '@odata.id': `https://graph.microsoft.com/v1.0/devices/${matchingDevice.id}`
            };

            return fetch(`https://graph.microsoft.com/v1.0/groups/${groupId}/members/$ref`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authforApp}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
        } else {
            throw new Error('Device not found.');
        }
    })
    .then(response => {
        if (response.ok) {
            alert(`Device added to group : ${groupName}`);
        } else {
            alert('failed to add device')
        }
    })
    .catch(error => {
        console.error('Error adding device to group:', error);
        alert('Failed to add device to group. Please check your network connection or try again later.');
    });



}


function removeDeviceToGroup(groupId, groupName, deviceId) 
{
    fetch(`https://graph.microsoft.com/v1.0/devices`, {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Failed to fetch devices. Status: ${response.status}`);
        }
        return response.json();
    })

    .then(devicesData => {
        const matchingDevice = devicesData.value.find(device => device.deviceId === deviceId);
        console.log('Matching Device:', matchingDevice);
            if (matchingDevice) {
                console.log('inside remove if condition...')
            const body = {
                '@odata.id': `https://graph.microsoft.com/v1.0/devices/${matchingDevice.id}`
            };

            return fetch(`https://graph.microsoft.com/v1.0/groups/${groupId}/members/${matchingDevice.id}/$ref`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${authforApp}`,
                    'Content-Type': 'application/json'
                },
            });
        } else {
            throw new Error('Device not found.');
        }
    })
    .then(response => {
        if (response.ok) {
            alert(`Device removed from group : ${groupName}`);
        } else {
            alert('failed to remove device')
        }
    })
    .catch(error => {
        console.error('Error removing device to group:', error);
        alert('Failed to remove device to group. Please check your network connection or try again later.');
    });


}



function addUserToGroup(groupId,groupName,userEmail) {

    
    const body = {
        '@odata.id': `https://graph.microsoft.com/v1.0/users/${userEmail}`
    };

    fetch(`https://graph.microsoft.com/v1.0/groups/${groupId}/members/$ref`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${authforApp}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
    })
    .then(response => {
        if (response.ok) {
            alert(`User added to group: ${groupName}`);
        } else {
            alert(`Failed to add user to group: ${groupName}`);
        }
    })
    .catch(error => {
        console.error('Error adding user to group:', error);
        alert('Failed to add user to group. Please check your network connection or try again later.');
    });
}


function removeUserToGroup(groupId,groupName,userEmail) 
{
    fetch(`https://graph.microsoft.com/v1.0/groups/${groupId}/members/$ref`, {
        method: 'DELETE',
        headers: {
            'Authorization': `Bearer ${authforApp}`,
            'Content-Type': 'application/json' // Include Content-Type header
        },
    })
    .then(response => {
        if (response.ok) {
            alert(`User removed from group: ${groupName}`);
        } else {
            alert(`Failed to remove user to group: ${groupName}`);
        }
    })
    .catch(error => {
        console.error('Error removing user to group:', error);
        alert('Failed to remove user to group. Please check your network connection or try again later.');
    });
}



function fetchGroupID(groupName) {
    return fetch(`https://graph.microsoft.com/v1.0/groups?$filter=displayName eq '${groupName}'`, {
        headers: {
            'Authorization': `Bearer ${authforApp}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data && data.value && data.value.length > 0) {
            return data.value[0].id; // Return the first group's ID
        }
        return null; // If group not found
    })
    .catch(error => {
        console.error('Error fetching group ID:', error);
        throw error;
    });
}


// Event Listener to close the Modals

document.getElementById("closeWipeModal").addEventListener("click", () => {
    document.getElementById("wipeModal").style.display = "none";
  });

  // Function to close the groupSelectionModal
  document.getElementById("closeGroupModal").addEventListener("click", () => {
    document.getElementById("groupSelectionModal").style.display = "none";
  });

  // Function to close the deviceSelectionModal
  document.getElementById("closeDeviceSelectionModal").addEventListener("click", () => {
    document.getElementById("deviceSelectionModal").style.display = "none";
  });

  // Function to close the deviceRemovalModal
  document.getElementById("closeDeviceRemovalModal").addEventListener("click", () => {
    document.getElementById("deviceRemovalModal").style.display = "none";
  });




  </script>

</body>
</html>
